{% extends "base.html" %}
{% block title %}Support Tickets â€“ Admin{% endblock %}

{% block content %}
<div class="page-shell">
  <div id="skelT">
    <div class="skeleton" style="width:200px;height:28px;margin-bottom:var(--sp-8);"></div>
    {% for i in range(5) %}
    <div
      style="display:flex;align-items:center;gap:var(--sp-4);padding:var(--sp-3) 0;border-bottom:1px solid var(--border-light);">
      <div class="skeleton" style="width:10px;height:10px;border-radius:50%;"></div>
      <div class="skeleton" style="width:260px;height:14px;"></div>
      <div class="skeleton" style="width:80px;height:22px;border-radius:20px;margin-left:auto;"></div>
    </div>
    {% endfor %}
  </div>

  <div id="realT" style="display:none;">
    <div class="page-header anim-fade">
      <div class="page-header-icon" style="background:linear-gradient(135deg,#f59e0b,#ef4444);">ğŸ«</div>
      <div>
        <h1>Support Tickets</h1>
        <p>Respond to and manage all user support requests.</p>
      </div>
      <a href="{{ url_for('admin.index') }}" class="btn btn-secondary" style="margin-left:auto;">â† Back</a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}{% for cat, msg in messages %}
    <div class="alert alert-{{ cat }} mb-4">{{ msg }}</div>
    {% endfor %}{% endif %}{% endwith %}

    <div class="filter-row mb-6">
      <a href="?status=open"
        class="filter-pill {{ 'filter-pill-active' if current_filter == 'open' else 'filter-pill-inactive' }}">ğŸŸ¢
        Open</a>
      <a href="?status=closed"
        class="filter-pill {{ 'filter-pill-active' if current_filter == 'closed' else 'filter-pill-inactive' }}">âš«
        Closed</a>
      <a href="?status=all"
        class="filter-pill {{ 'filter-pill-active' if current_filter == 'all' else 'filter-pill-inactive' }}">ğŸ“‹ All</a>
    </div>

    <div class="card">
      {% if tickets %}
      {% for ticket in tickets %}
      <div
        style="display:flex;align-items:center;gap:var(--sp-4);padding:var(--sp-4) var(--sp-6);border-bottom:1px solid var(--border-light);transition:background var(--dur);"
        onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background=''">
        <div
          style="width:10px;height:10px;border-radius:50%;flex-shrink:0;background:{{ 'var(--success)' if ticket.status == 'open' else 'var(--text-faint)' }};{{ 'box-shadow:0 0 0 3px rgba(16,185,129,.2)' if ticket.status == 'open' else '' }};">
        </div>
        <div style="flex:1;min-width:0;">
          <a href="{{ url_for('support.view_ticket', ticket_id=ticket.id) }}"
            style="font-weight:700;font-size:var(--fs-sm);color:var(--text-primary);">{{ ticket.subject }}</a>
          <div style="font-size:var(--fs-xs);color:var(--text-faint);margin-top:2px;">{{ ticket.user.username }} Â· {{
            ticket.replies.count() }} replies</div>
        </div>
        <span class="badge {{ 'badge-success' if ticket.status == 'open' else 'badge-neutral' }}">{{ ticket.status|title
          }}</span>
        <div style="font-size:var(--fs-xs);color:var(--text-faint);white-space:nowrap;">{{
          ticket.created_at.strftime('%b %d, %H:%M') }}</div>
      </div>
      {% endfor %}
      {% else %}
      <div class="text-center" style="padding:var(--sp-12);color:var(--text-faint);">
        <div style="font-size:2.5rem;margin-bottom:var(--sp-3);">âœ…</div>
        <p style="font-weight:600;">No tickets found.</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
<script>
  setTimeout(() => { document.getElementById('skelT').style.display = 'none'; document.getElementById('realT').style.display = 'block'; }, 1000);
</script>
{% endblock %}