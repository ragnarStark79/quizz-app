{% extends "base.html" %}
{% block title %}Activity Logs ‚Äì Admin{% endblock %}

{% block content %}
<div class="page-shell">
  <div id="skelA">
    <div class="skeleton" style="width:200px;height:28px;margin-bottom:var(--sp-8);"></div>
    {% for i in range(6) %}
    <div
      style="display:flex;align-items:center;gap:var(--sp-4);padding:var(--sp-3) 0;border-bottom:1px solid var(--border-light);">
      <div class="skeleton" style="width:80px;height:14px;"></div>
      <div class="skeleton" style="width:160px;height:14px;"></div>
      <div class="skeleton" style="width:60px;height:14px;margin-left:auto;"></div>
    </div>
    {% endfor %}
  </div>

  <div id="realA" style="display:none;">
    <div class="page-header anim-fade">
      <div class="page-header-icon" style="background:linear-gradient(135deg,#10b981,#0ea5e9);">üìã</div>
      <div>
        <h1>Activity Logs</h1>
        <p>Track all user actions across the platform.</p>
      </div>
      <a href="{{ url_for('admin.index') }}" class="btn btn-secondary" style="margin-left:auto;">‚Üê Back</a>
    </div>

    <!-- Filters -->
    <div class="glass-card-static mb-6" style="padding:var(--sp-4) var(--sp-6);">
      <form method="GET" class="flex items-center gap-4" style="flex-wrap:wrap;">
        <select name="user_id" class="form-control" style="width:auto;min-width:180px;">
          <option value="">All Users</option>
          {% for u in users %}
          <option value="{{ u.id }}" {{ 'selected' if user_filter==u.id }}>{{ u.username }}</option>
          {% endfor %}
        </select>
        <input type="text" name="action" class="form-control" style="width:auto;min-width:180px;"
          placeholder="Filter by action‚Ä¶" value="{{ action_filter }}">
        <button type="submit" class="btn btn-primary btn-sm">Filter</button>
        <a href="{{ url_for('admin.activity_logs') }}" class="btn btn-secondary btn-sm">Reset</a>
      </form>
    </div>

    <div class="table-wrap">
      <table class="premium-table">
        <thead>
          <tr>
            <th>User</th>
            <th>Action</th>
            <th>Description</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody>
          {% for log in logs %}
          <tr>
            <td>
              <a href="{{ url_for('admin.user_detail', user_id=log.user_id) }}"
                style="font-weight:600;color:var(--primary);">{{ log.user.username if log.user else '(deleted)' }}</a>
            </td>
            <td><span class="badge badge-primary">{{ log.action_type }}</span></td>
            <td style="color:var(--text-secondary);">{{ log.description or '‚Äî' }}</td>
            <td style="font-size:var(--fs-xs);color:var(--text-faint);white-space:nowrap;">{{ log.timestamp.strftime('%b
              %d, %H:%M') }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="4" class="text-center" style="padding:var(--sp-10);color:var(--text-faint);font-weight:600;">No
              logs found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if pagination.pages > 1 %}
    <div class="flex justify-between items-center mt-6" style="font-size:var(--fs-sm);">
      {% if pagination.has_prev %}
      <a href="?page={{ pagination.prev_num }}&user_id={{ user_filter or '' }}&action={{ action_filter or '' }}"
        class="btn btn-secondary btn-sm">‚Üê Previous</a>
      {% else %}<span></span>{% endif %}
      <span class="text-faint">Page {{ pagination.page }} of {{ pagination.pages }}</span>
      {% if pagination.has_next %}
      <a href="?page={{ pagination.next_num }}&user_id={{ user_filter or '' }}&action={{ action_filter or '' }}"
        class="btn btn-secondary btn-sm">Next ‚Üí</a>
      {% else %}<span></span>{% endif %}
    </div>
    {% endif %}
  </div>
</div>
<script>
  setTimeout(() => { document.getElementById('skelA').style.display = 'none'; document.getElementById('realA').style.display = 'block'; }, 1000);
</script>
{% endblock %}