{% extends "base.html" %}
{% block title %}Quiz Builder ‚Äì {{ quiz.title }}{% endblock %}

{% block content %}
<div class="page-shell">
  <div class="page-header anim-fade">
    <div class="page-header-icon" style="background:linear-gradient(135deg,var(--primary),#8b5cf6);">‚öôÔ∏è</div>
    <div>
      <h1>Quiz Builder</h1>
      <p>Manage settings and add questions.</p>
    </div>
    <a href="{{ url_for('quiz.list_quizzes') }}" class="btn btn-secondary" style="margin-left:auto;">‚Üê Back</a>
  </div>

  <div class="alerts">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}{% for cat, msg in messages %}
    <div class="alert alert-{{ cat }}">{{ msg }}</div>
    {% endfor %}{% endif %}{% endwith %}
  </div>

  <div class="grid gap-6" style="grid-template-columns:1fr 1.2fr;align-items:start;">

    <!-- Left: Quiz Settings -->
    <div class="glass-card anim-slide" style="--i:0;">
      <h3 style="margin:0 0 var(--sp-6);font-size:var(--fs-lg);">‚öôÔ∏è Quiz Settings</h3>
      <form method="POST" action="{{ url_for('quiz.edit_quiz', quiz_id=quiz.id) }}">
        <input type="hidden" name="action" value="update_details">

        <div class="form-group">
          <label class="form-label">Status</label>
          <select name="status" class="form-control">
            <option value="draft" {% if quiz.status=='draft' %}selected{% endif %}>Draft (Hidden)</option>
            <option value="scheduled" {% if quiz.status=='scheduled' %}selected{% endif %}>Scheduled</option>
            <option value="active" {% if quiz.status=='active' %}selected{% endif %}>Active (Public)</option>
            <option value="closed" {% if quiz.status=='closed' %}selected{% endif %}>Closed</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Title</label>
          <input type="text" name="title" class="form-control" value="{{ quiz.title }}" required>
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea name="description" class="form-control" rows="3">{{ quiz.description or '' }}</textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Time Limit <span class="form-hint">(min)</span></label>
          <input type="number" name="time_limit" class="form-control" value="{{ quiz.time_limit or '' }}">
        </div>
        <div class="form-group">
          <label class="form-label">Start Time <span class="form-hint">(Optional)</span></label>
          <input type="datetime-local" name="start_time" class="form-control"
            value="{{ quiz.start_time.strftime('%Y-%m-%dT%H:%M') if quiz.start_time else '' }}">
        </div>
        <div class="form-group">
          <label class="form-label">End Time <span class="form-hint">(Optional)</span></label>
          <input type="datetime-local" name="end_time" class="form-control"
            value="{{ quiz.end_time.strftime('%Y-%m-%dT%H:%M') if quiz.end_time else '' }}">
        </div>
        <button type="submit" class="btn btn-primary btn-block">Save Settings</button>
      </form>
    </div>

    <!-- Right: Questions -->
    <div>
      <!-- Add question -->
      <div class="glass-card anim-slide mb-6" style="--i:1;">
        <h3 style="margin:0 0 var(--sp-6);font-size:var(--fs-lg);">‚ûï Add Question</h3>
        <form method="POST" action="{{ url_for('quiz.edit_quiz', quiz_id=quiz.id) }}">
          <input type="hidden" name="action" value="add_question">
          <div class="form-group">
            <label class="form-label">Question Text</label>
            <textarea name="question_text" class="form-control" rows="2" required
              placeholder="Type your question here‚Ä¶"></textarea>
          </div>
          <div class="grid grid-2 gap-4">
            <div class="form-group">
              <label class="form-label">Option A</label>
              <input type="text" name="option_a" class="form-control" required placeholder="Answer A">
            </div>
            <div class="form-group">
              <label class="form-label">Option B</label>
              <input type="text" name="option_b" class="form-control" required placeholder="Answer B">
            </div>
            <div class="form-group">
              <label class="form-label">Option C</label>
              <input type="text" name="option_c" class="form-control" required placeholder="Answer C">
            </div>
            <div class="form-group">
              <label class="form-label">Option D</label>
              <input type="text" name="option_d" class="form-control" required placeholder="Answer D">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Correct Answer</label>
            <select name="correct_option" class="form-control" required>
              <option value="A">Option A</option>
              <option value="B">Option B</option>
              <option value="C">Option C</option>
              <option value="D">Option D</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary btn-block">+ Add Question</button>
        </form>
      </div>

      <!-- Existing questions -->
      <h3 class="mb-4" style="font-size:var(--fs-md);">üìã Questions ({{ questions|length }})</h3>
      {% if questions %}
      {% for q in questions %}
      <div class="card mb-4 anim-slide anim-stagger" style="--i:{{ loop.index0 + 2 }};padding:var(--sp-5);">
        <div class="flex items-center justify-between mb-3">
          <span style="font-weight:700;color:var(--text-primary);">{{ loop.index }}. {{ q.question_text }}</span>
          <form action="{{ url_for('quiz.delete_question', question_id=q.id) }}" method="POST"
            onsubmit="return confirm('Delete this question?');">
            <button type="submit" class="btn btn-danger btn-sm">Remove</button>
          </form>
        </div>
        <div class="grid grid-2 gap-2" style="font-size:var(--fs-sm);">
          <div
            style="padding:var(--sp-2) var(--sp-3);border-radius:var(--radius-sm);{% if q.correct_option == 'A' %}background:#d1fae5;color:#065f46;font-weight:600;{% else %}color:var(--text-muted);{% endif %}">
            A: {{ q.option_a }}</div>
          <div
            style="padding:var(--sp-2) var(--sp-3);border-radius:var(--radius-sm);{% if q.correct_option == 'B' %}background:#d1fae5;color:#065f46;font-weight:600;{% else %}color:var(--text-muted);{% endif %}">
            B: {{ q.option_b }}</div>
          <div
            style="padding:var(--sp-2) var(--sp-3);border-radius:var(--radius-sm);{% if q.correct_option == 'C' %}background:#d1fae5;color:#065f46;font-weight:600;{% else %}color:var(--text-muted);{% endif %}">
            C: {{ q.option_c }}</div>
          <div
            style="padding:var(--sp-2) var(--sp-3);border-radius:var(--radius-sm);{% if q.correct_option == 'D' %}background:#d1fae5;color:#065f46;font-weight:600;{% else %}color:var(--text-muted);{% endif %}">
            D: {{ q.option_d }}</div>
        </div>
      </div>
      {% endfor %}
      {% else %}
      <p class="text-muted" style="font-size:var(--fs-sm);">No questions added yet.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}