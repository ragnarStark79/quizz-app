{% extends "base.html" %}
{% block title %}Results ‚Äì {{ attempt.quiz.title }}{% endblock %}

{% block content %}
<div class="page-shell" style="max-width:var(--max-w-lg);">
  <div class="flex items-center justify-between mb-6 anim-fade" style="flex-wrap:wrap;gap:var(--sp-3);">
    <h2 style="margin:0;font-size:var(--fs-xl);">Quiz Results</h2>
    <a href="{{ url_for('quiz.explore_quizzes') }}" class="btn btn-secondary">‚Üê Explore</a>
  </div>

  <!-- Score card -->
  <div class="glass-card text-center mb-8 anim-scale">
    <p class="text-muted font-600" style="font-size:var(--fs-sm);margin-bottom:var(--sp-2);">Your Score</p>
    <div style="font-size:3.5rem;font-weight:900;color:var(--primary);line-height:1;">
      {{ attempt.score }}<span style="font-size:1.5rem;color:var(--text-faint);">/{{ attempt.quiz.questions.count()
        }}</span>
    </div>
    <div class="text-score {% if attempt.accuracy >= 70 %}text-success{% else %}text-error{% endif %}"
      style="margin-top:var(--sp-3);">
      Accuracy: {{ "%.1f"|format(attempt.accuracy) }}%
    </div>
  </div>

  <!-- Review -->
  <h3 class="mb-4" style="font-size:var(--fs-md);">üìã Detailed Review</h3>
  {% for answer in attempt.answers %}
  <div class="card mb-4 anim-slide anim-stagger"
    style="--i:{{ loop.index0 }};padding:var(--sp-5);border-left:4px solid {{ 'var(--success)' if answer.is_correct else 'var(--error)' }};">
    <h4 style="margin:0 0 var(--sp-3);font-size:var(--fs-base);">Q{{ loop.index }}: {{ answer.question.question_text }}
    </h4>
    <div class="grid grid-2 gap-3" style="font-size:var(--fs-sm);">
      <div class="user-answer {{ 'bg-success-light' if answer.is_correct else 'bg-error-light' }}"
        style="padding:var(--sp-3);border-radius:var(--radius-sm);">
        <span class="font-600 mb-05 {{ 'text-success-dark' if answer.is_correct else 'text-error-dark' }}">
          Your Answer ({{ 'Correct' if answer.is_correct else 'Incorrect' }})
        </span>
        {% if answer.selected_option == 'A' %}{{ answer.question.option_a }}
        {% elif answer.selected_option == 'B' %}{{ answer.question.option_b }}
        {% elif answer.selected_option == 'C' %}{{ answer.question.option_c }}
        {% elif answer.selected_option == 'D' %}{{ answer.question.option_d }}
        {% else %}No answer{% endif %}
      </div>
      {% if not answer.is_correct %}
      <div
        style="padding:var(--sp-3);border-radius:var(--radius-sm);background:#eef2ff;border:1px dashed var(--primary);">
        <span style="font-weight:600;color:var(--primary);display:block;margin-bottom:var(--sp-2);">Correct
          Answer</span>
        {% if answer.question.correct_option == 'A' %}{{ answer.question.option_a }}
        {% elif answer.question.correct_option == 'B' %}{{ answer.question.option_b }}
        {% elif answer.question.correct_option == 'C' %}{{ answer.question.option_c }}
        {% elif answer.question.correct_option == 'D' %}{{ answer.question.option_d }}{% endif %}
      </div>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}